// TODO: Update devcontainer configuration as needed
//       - Add additional VS Code extensions
//       - Configure database migrations on startup
//       - Add pre-commit hooks setup
// For format details, see https://aka.ms/devcontainer.json. For config options, see the
// README at: https://github.com/devcontainers/templates/tree/main/src/python
	
{
	"name": "Citatum Development Container",
	"dockerComposeFile": "../docker/docker-compose.yml",
	"service": "fastapi",
	"workspaceFolder": "/app",
	"shutdownAction": "stopCompose",
	"initializeCommand": [
	  "bash",
	  "-c",
	  "test -f env/fastapi/.env || cp env/fastapi/.env.example env/fastapi/.env"
	],
	"features": {
	  "ghcr.io/devcontainers/features/docker-in-docker:2": {},
	  "ghcr.io/devcontainers/features/git:1": {}
	},
	"forwardPorts": [
	  8000
	],
	"portsAttributes": {
	  "8000": {
		"label": "FastAPI Application",
		"onAutoForward": "notify"
	  }
	},
	"postCreateCommand": "uv sync && echo 'Container ready!'",
	"overrideCommand": true,
	"postStartCommand": "bash -lc 'uv run uvicorn src.main:app --host 0.0.0.0 --port 8000 --reload &'",
	"customizations": {
	  "vscode": {
		"extensions": [
		  "ms-python.python",
		  "ms-python.vscode-pylance",
		  "charliermarsh.ruff",
		  "ms-python.black-formatter",
		  "ms-azuretools.vscode-docker"
		],
		"settings": {
		  "python.defaultInterpreterPath": "/usr/local/bin/python",
		  "python.linting.enabled": true,
		  "python.linting.pylintEnabled": false,
		  "python.formatting.provider": "black",
		  "editor.formatOnSave": true,
		  "files.exclude": {
			"**/__pycache__": true,
			"**/*.pyc": true
		  }
		}
	  }
	},
	"remoteUser": "root"
  }